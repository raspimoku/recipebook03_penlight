# Pico W ã‚«ãƒ©ãƒ¼ãƒ©ã‚¤ãƒˆ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼

Raspberry Pi Pico W ã¨ãƒ•ãƒ«ã‚«ãƒ©ãƒ¼LEDã‚’ä½¿ç”¨ã—ãŸãƒšãƒ³ãƒ©ã‚¤ãƒˆã‚’Web Bluetooth APIã§åˆ¶å¾¡ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

- **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: Raspberry Pi Pico W + NeoPixeläº’æ›ãƒ•ãƒ«ã‚«ãƒ©ãƒ¼LED
- **åˆ¶å¾¡æ–¹æ³•**: Web Bluetooth API ã‚’ä½¿ç”¨ã—ãŸPWAï¼ˆProgressive Web Appï¼‰
- **è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ**: è¤‡æ•°ã®ãƒ©ã‚¤ãƒˆã«åŒæ™‚æ¥ç¶šãƒ»åˆ¶å¾¡å¯èƒ½
- **ä¸»ãªæ©Ÿèƒ½**:
  - **è‰²é¸æŠãƒ¢ãƒ¼ãƒ‰**: HSLã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§è‡ªç”±ãªè‰²é¸æŠ
  - **è‡ªå‹•åˆ¶å¾¡ãƒ¢ãƒ¼ãƒ‰**: 3ç¨®é¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§è‡ªå‹•çš„ã«è‰²å¤‰åŒ–
  - **éŸ³æ¥½é€£å‹•ãƒ¢ãƒ¼ãƒ‰**: ãƒã‚¤ã‚¯ã‹ã‚‰ã®éŸ³å£°å…¥åŠ›ã«åå¿œã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è‰²å¤‰åŒ–ï¼ˆ5ç¨®é¡ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼‰
  - **ã‚°ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡**: ãƒ‡ãƒã‚¤ã‚¹ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã—ã¦ä¸€æ‹¬åˆ¶å¾¡

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

![ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³](docs/system-architecture.svg)

## ğŸ› ï¸ å¿…è¦ãªéƒ¨å“

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢
- **Raspberry Pi Pico W**ï¼ˆRaspberry Pi Pico 2 W ã§ã‚‚å¯ï¼‰
- **USBã‚±ãƒ¼ãƒ–ãƒ«** (Micro-B)
- **ãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ã‚·ãƒªã‚¢ãƒ«LEDãƒ†ãƒ¼ãƒ—** SSCI-014007
  - [https://www.switch-science.com/products/1400](https://www.switch-science.com/products/1400)
  - NeoPixel (WS2812B) äº’æ›LED
- **ã‚¹ãƒ«ãƒ¼ãƒ›ãƒ¼ãƒ«ç”¨ãƒ†ã‚¹ãƒˆãƒ¯ã‚¤ãƒ¤** (ã‚ªã‚¹-ã‚ªã‚¹) TTW-200
  - [https://shop.sunhayato.co.jp/products/ttw-200](https://shop.sunhayato.co.jp/products/ttw-200)
- **é›»æº**ï¼ˆUSBãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ã¾ãŸã¯ä¹¾é›»æ± ï¼‰

### ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢
- **MicroPython** Pico W v1.23.0 ä»¥é™
  - [https://micropython.org/download/RPI_PICO_W/](https://micropython.org/download/RPI_PICO_W/)
- **Thonny** 4.1.6 ä»¥é™
- **Webãƒ–ãƒ©ã‚¦ã‚¶**ï¼ˆWeb Bluetooth APIå¯¾å¿œï¼‰
  - Chromeã€Edgeã€Operaæ¨å¥¨
  - HTTPSç’°å¢ƒãŒå¿…è¦

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®æ¥ç¶š

LEDãƒ†ãƒ¼ãƒ—ã‚’Raspberry Pi Pico Wã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ¥ç¶šï¼š

| LED | Pico W |
|-----|--------|
| DI | GPIO6 |
| VCC | VBUS (5V) |
| GND | GND |

### 2. Raspberry Pi Pico W ã®è¨­å®š

1. **MicroPythonãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   - [MicroPythonãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸](https://micropython.org/download/RPI_PICO_W/)ã‹ã‚‰æœ€æ–°ç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - BOOTSELãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãªãŒã‚‰Pico Wã‚’PCã«æ¥ç¶š
   - `.uf2`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ã‚¤ãƒ–ã«ã‚³ãƒ”ãƒ¼

2. **ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**
   - Thonnyã‚’èµ·å‹•
   - `pico/main.py` ã‚’é–‹ã
   - å¿…è¦ã«å¿œã˜ã¦ `DEVICE_ID` ã‚’å¤‰æ›´ï¼ˆè¤‡æ•°å°ä½¿ç”¨æ™‚ã€å„ãƒ‡ãƒã‚¤ã‚¹ã§ç•°ãªã‚‹ç•ªå·ã‚’è¨­å®šï¼‰
   - Pico Wã«ä¿å­˜ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å: `main.py`ï¼‰

3. **å‹•ä½œç¢ºèª**
   - Pico Wã‚’ãƒªã‚»ãƒƒãƒˆ
   - èµ·å‹•æ™‚ã«èµ¤â†’ç·‘â†’é’ã®ãƒ†ã‚¹ãƒˆç‚¹ç¯ãŒå®Ÿè¡Œã•ã‚Œã‚‹
   - ãã®å¾Œã€é’è‰²ã®ç‚¹æ»…ãŒå§‹ã¾ã‚‹ï¼ˆBluetoothå¾…æ©ŸçŠ¶æ…‹ï¼‰

### 3. Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç‰ˆã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆæ¨å¥¨ï¼‰

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸è¦ã§ã€ã™ãã«å‹•ä½œç¢ºèªã§ãã¾ã™ã€‚

**å…¬é–‹URL**: [https://raspimoku.github.io/picow-colorlight-web/](https://raspimoku.github.io/picow-colorlight-web/)

ã“ã®ã‚µã‚¤ãƒˆã¯GitHub Pagesã§ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ãŠã‚Šã€HTTPSå¯¾å¿œæ¸ˆã¿ã®ãŸã‚ã€Web Bluetooth APIãŒãã®ã¾ã¾åˆ©ç”¨ã§ãã¾ã™ã€‚

> **ãƒ¡ãƒªãƒƒãƒˆ**:
> - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸è¦ã§ã™ãã«ä½¿ãˆã‚‹
> - HTTPSç’°å¢ƒãŒæ§‹ç¯‰æ¸ˆã¿
> - æœ€æ–°ç‰ˆãŒå¸¸ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹
> - ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚„ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã‹ã‚‰ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

#### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§ã®å®Ÿè¡Œ

ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚„é–‹ç™ºã‚’è¡Œã†å ´åˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§HTTPSã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

Web Bluetooth APIã¯HTTPSç’°å¢ƒãŒå¿…é ˆã®ãŸã‚ã€`server.py`ã‚’ä½¿ç”¨ã—ã¦HTTPSã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚

**1. è‡ªå·±ç½²åè¨¼æ˜æ›¸ã®ç”Ÿæˆ**

```bash
cd app
openssl req -x509 -newkey rsa:2048 -nodes \
  -keyout key.pem -out cert.pem -days 365 \
  -subj '/CN=localhost'
```

å®Ÿè¡Œã™ã‚‹ã¨ `cert.pem`ï¼ˆè¨¼æ˜æ›¸ï¼‰ã¨ `key.pem`ï¼ˆç§˜å¯†éµï¼‰ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

**2. HTTPSã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•**

```bash
python server.py
```

ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
HTTPSã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã—ãŸ
ã‚¢ã‚¯ã‚»ã‚¹URL: https://localhost:8000

æ³¨æ„: è‡ªå·±ç½²åè¨¼æ˜æ›¸ã®ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã¾ã™
      ã€Œè©³ç´°è¨­å®šã€â†’ã€Œlocalhost ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ˆå®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€ã‚’é¸æŠã—ã¦ãã ã•ã„
```

**3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹**

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ `https://localhost:8000` ã«ã‚¢ã‚¯ã‚»ã‚¹
2. è¨¼æ˜æ›¸ã®è­¦å‘ŠãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä»¥ä¸‹ã®æ‰‹é †ã§é€²ã‚€ï¼š
   - **Chrome/Edge**: ã€Œè©³ç´°è¨­å®šã€â†’ã€Œlocalhost ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼ˆå®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€
   - **Firefox**: ã€Œè©³ç´°ã‚’è¡¨ç¤ºã€â†’ã€Œä¾‹å¤–ã‚’è¿½åŠ ã€â†’ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾‹å¤–ã‚’æ‰¿èªã€
3. Webã‚¢ãƒ—ãƒªãŒè¡¨ç¤ºã•ã‚Œã‚‹

> **æ³¨æ„**: è¨¼æ˜æ›¸ã¯1å¹´é–“æœ‰åŠ¹ã§ã™ã€‚æœŸé™åˆ‡ã‚Œã®å ´åˆã¯ã€æ‰‹é †1ã‹ã‚‰å†åº¦è¨¼æ˜æ›¸ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

#### PWAã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. Webã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã¾ãŸã¯ã€Œã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚’é¸æŠ
3. ã‚¢ãƒ—ãƒªãŒãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã•ã‚Œã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚èµ·å‹•å¯èƒ½ã«ãªã‚Šã¾ã™

#### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

**ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«**

- **Chrome/Edge**: `F12` ã¾ãŸã¯ å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæ¤œè¨¼ã€
- **Firefox**: `F12` ã¾ãŸã¯ å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œè¦ç´ ã‚’èª¿æŸ»ã€

**ç¢ºèªã™ã¹ãé …ç›®**:

1. **Console ã‚¿ãƒ–**
   - JavaScript ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
   - Bluetooth æ¥ç¶šã®ãƒ­ã‚°ã‚’ç¢ºèª
   - ä¾‹: `Color set to RGB(255, 0, 0)` ãªã©

2. **Application ã‚¿ãƒ–** (Chrome/Edge)
   - Service Worker ã®ç™»éŒ²çŠ¶æ…‹ã‚’ç¢ºèª
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å†…å®¹ã‚’ç¢ºèª
   - Manifest ã®èª­ã¿è¾¼ã¿çŠ¶æ…‹ã‚’ç¢ºèª

3. **Network ã‚¿ãƒ–**
   - ãƒªã‚½ãƒ¼ã‚¹ã®èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç¢ºèª
   - HTTPS ã§æ­£ã—ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã¦ã„ã‚‹ã‹ç¢ºèª

**ã‚ˆãã‚ã‚‹ãƒ‡ãƒãƒƒã‚°æ–¹æ³•**:

```javascript
// script_multi.js ã«è¿½åŠ ã—ã¦ãƒ‡ãƒãƒƒã‚°
console.log('Current device count:', this.devices.size);
console.log('Selected target:', this.controlTarget);
console.log('Sending color:', { r, g, b });
```

**Bluetooth ãƒ‡ãƒãƒƒã‚°**:

Chrome ã§ `chrome://bluetooth-internals` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Bluetooth ãƒ‡ãƒã‚¤ã‚¹ã®è©³ç´°æƒ…å ±ã‚’ç¢ºèªã§ãã¾ã™ã€‚

## ğŸ® ä½¿ç”¨æ–¹æ³•

### æ¥ç¶š
1. Raspberry Pi Pico W ã‚’èµ·å‹•ï¼ˆé’è‰²ã®ç‚¹æ»…ã§å¾…æ©ŸçŠ¶æ…‹ã‚’ç¢ºèªï¼‰
2. Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€Œãƒ©ã‚¤ãƒˆã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. "Colorlight-X" ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠï¼ˆXã¯ãƒ‡ãƒã‚¤ã‚¹ç•ªå·ï¼‰
4. æ¥ç¶šå®Œäº†å¾Œã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§èµ¤è‰²ã«ç‚¹ç¯
5. è¤‡æ•°å°æ¥ç¶šã™ã‚‹å ´åˆã¯ã€æ‰‹é †2-4ã‚’ç¹°ã‚Šè¿”ã™

### åˆ¶å¾¡å¯¾è±¡ã®é¸æŠ

æ¥ç¶šå¾Œã€åˆ¶å¾¡å¯¾è±¡ã‚’é¸æŠã§ãã¾ã™ï¼š

- **å…¨ãƒ‡ãƒã‚¤ã‚¹**: æ¥ç¶šä¸­ã®å…¨ãƒ‡ãƒã‚¤ã‚¹ã‚’ä¸€æ‹¬åˆ¶å¾¡
- **ã‚°ãƒ«ãƒ¼ãƒ—**: ã‚°ãƒ«ãƒ¼ãƒ—A/B/Cã«åˆ†é¡ã—ã¦åˆ¶å¾¡
- **å€‹åˆ¥**: ç‰¹å®šã®ãƒ‡ãƒã‚¤ã‚¹1å°ã®ã¿ã‚’åˆ¶å¾¡

### è‰²é¸æŠãƒ¢ãƒ¼ãƒ‰

#### HSLã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼
- **è‰²ç›¸ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼**: åŸºæœ¬ã¨ãªã‚‹è‰²ã‚’é¸æŠï¼ˆèµ¤â†’æ©™â†’é»„â†’ç·‘â†’é’â†’ç´«ï¼‰
- **2Dãƒ”ãƒƒã‚«ãƒ¼**: ãƒã‚¦ã‚¹ã‚„ã‚¿ãƒƒãƒã§å½©åº¦ã¨æ˜åº¦ã‚’èª¿æ•´
  - æ¨ªæ–¹å‘: å½©åº¦ï¼ˆå·¦ï¼šç™½ã£ã½ã„ â†” å³ï¼šé®®ã‚„ã‹ï¼‰
  - ç¸¦æ–¹å‘: æ˜åº¦ï¼ˆä¸Šï¼šæ˜ã‚‹ã„ â†” ä¸‹ï¼šæš—ã„ï¼‰
- **Hexã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰**: `#RRGGBB`å½¢å¼ã§ç›´æ¥å…¥åŠ›ã‚‚å¯èƒ½

#### ãƒ—ãƒªã‚»ãƒƒãƒˆè‰²
ã‚ˆãä½¿ã†10è‰²ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰é¸æŠï¼š
èµ¤ã€ã‚ªãƒ¬ãƒ³ã‚¸ã€é»„è‰²ã€ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚°ãƒªãƒ¼ãƒ³ã€ç·‘ã€é’ã€ç´«ã€ãƒã‚¼ãƒ³ã‚¿ã€ã‚·ã‚¢ãƒ³ã€ç™½

### è‡ªå‹•åˆ¶å¾¡ãƒ¢ãƒ¼ãƒ‰

3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰é¸æŠï¼š

- **ãƒ‘ã‚¿ãƒ¼ãƒ³1: é †æ¬¡å¤‰åŒ–**
  - 7è‰²ã‚’1ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ
  - èµ¤â†’æ©™â†’é»„â†’ç·‘â†’é’â†’ç´«â†’ãƒ”ãƒ³ã‚¯â†’ï¼ˆç¹°ã‚Šè¿”ã—ï¼‰

- **ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç‚¹æ»…ãƒ‘ã‚¿ãƒ¼ãƒ³**
  - å„è‰²ã§ç‚¹ç¯ãƒ»æ¶ˆç¯ã‚’ç¹°ã‚Šè¿”ã—ãªãŒã‚‰è‰²å¤‰åŒ–
  - ç‚¹ç¯1ç§’â†’æ¶ˆç¯1ç§’ã®ãƒªã‚ºãƒ 

- **ãƒ‘ã‚¿ãƒ¼ãƒ³3: è™¹è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**
  - 96æ®µéšã®æ»‘ã‚‰ã‹ãªè™¹è‰²å¤‰åŒ–
  - 0.5ç§’ã”ã¨ã«æ¬¡ã®è‰²ã¸é·ç§»

### éŸ³æ¥½é€£å‹•ãƒ¢ãƒ¼ãƒ‰

ãƒã‚¤ã‚¯ã‹ã‚‰ã®éŸ³å£°å…¥åŠ›ã«åå¿œã—ã¦LEDãŒå¤‰åŒ–ã—ã¾ã™ã€‚

#### ä½¿ã„æ–¹
1. ã€ŒéŸ³æ¥½é€£å‹•é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯
3. éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã¨ã€éŸ³ã«åˆã‚ã›ã¦LEDãŒå¤‰åŒ–

#### ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆ5ç¨®é¡ï¼‰

1. **æ˜ã‚‹ã•å¤‰åŒ–**
   - é¸æŠã—ãŸå˜è‰²ã§éŸ³é‡ã«å¿œã˜ã¦æ˜ã‚‹ã•ãŒå¤‰åŒ–
   - ãƒ™ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼ã‹ã‚‰é¸æŠå¯èƒ½

2. **å‘¨æ³¢æ•°é€£å‹•**
   - ä½éŸ³â†’èµ¤ã€ä¸­éŸ³â†’ç·‘ã€é«˜éŸ³â†’é’ã«å¤‰åŒ–
   - éŸ³ã®é«˜ã•ã§è‰²ãŒå¤‰ã‚ã‚‹

3. **éŸ³éšé€£å‹•**
   - ãƒ‰â†’èµ¤ã€ãƒ¬â†’æ©™ã€ãƒŸâ†’é»„ã€ãƒ•ã‚¡â†’ç·‘ã€ã‚½â†’é’ã€ãƒ©â†’ç´«ã€ã‚·â†’ãƒ”ãƒ³ã‚¯ã«å¤‰åŒ–
   - éŸ³éšã‚’æ¤œå‡ºã—ã¦è™¹è‰²è¡¨ç¤º

4. **ãƒ“ãƒ¼ãƒˆæ¤œå‡º**
   - ãƒ“ãƒ¼ãƒˆã‚’æ¤œå‡ºã—ã¦è™¹è‰²ã«å¤‰åŒ–
   - ãƒªã‚ºãƒ ã«åˆã‚ã›ã¦ã‚«ãƒ©ãƒ•ãƒ«ã«ç‚¹ç¯

5. **ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼**
   - éŸ³é‡ã«å¿œã˜ã¦è™¹è‰²ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
   - éŸ³ãŒå¤§ãã„ã»ã©é€Ÿãå¤‰åŒ–

#### æ„Ÿåº¦èª¿æ•´
ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§1ã€œ10æ®µéšã®æ„Ÿåº¦èª¿æ•´ãŒå¯èƒ½

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```
recipebook03_penlight/
â”œâ”€â”€ pico/                # Raspberry Pi Pico Wå´ã®ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ main.py             # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆå˜ä¸€GPIOåˆ¶å¾¡ç”¨ï¼‰
â”‚   â””â”€â”€ main_multi_gpio.py  # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆè¤‡æ•°GPIOåˆ¶å¾¡ç”¨ï¼‰
â”œâ”€â”€ app/                    # Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ index.html          # HTML
â”‚   â”œâ”€â”€ style.css           # CSS
â”‚   â”œâ”€â”€ script_multi.js     # JavaScript
â”‚   â”œâ”€â”€ server.py           # HTTPSé–‹ç™ºã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ service-worker.js   # Service Workerï¼ˆPWAå¯¾å¿œï¼‰
â”‚   â””â”€â”€ manifest.json       # PWAãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â””â”€â”€ README.md               # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ”§ æŠ€è¡“ä»•æ§˜

### Bluetooth Low Energy (BLE)

#### ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯
- **ã‚µãƒ¼ãƒ“ã‚¹UUID**: `12345678-1234-1234-1234-123456789abc`
- **è‰²åˆ¶å¾¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯**: `12345678-1234-1234-1234-123456789abd`
  - ãƒ•ãƒ©ã‚°: READ, WRITE
  - ãƒ‡ãƒ¼ã‚¿å½¢å¼: 3ãƒã‚¤ãƒˆ (R, G, B)
- **ã‚³ãƒãƒ³ãƒ‰åˆ¶å¾¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯**: `12345678-1234-1234-1234-123456789abe`
  - ãƒ•ãƒ©ã‚°: READ, WRITE
  - ãƒ‡ãƒ¼ã‚¿å½¢å¼: UTF-8æ–‡å­—åˆ—

#### ãƒ‡ãƒã‚¤ã‚¹å
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: `Colorlight-{DEVICE_ID}`
- ä¾‹: `Colorlight-1`, `Colorlight-2`, ...

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

#### è‰²ãƒ‡ãƒ¼ã‚¿ï¼ˆRGBï¼‰
3ãƒã‚¤ãƒˆã®ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿:
```
[R (0-255), G (0-255), B (0-255)]
```

#### ã‚³ãƒãƒ³ãƒ‰
UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ–‡å­—åˆ—:

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `AUTO:1` | è‡ªå‹•åˆ¶å¾¡é–‹å§‹ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³1: é †æ¬¡å¤‰åŒ–ï¼‰ |
| `AUTO:2` | è‡ªå‹•åˆ¶å¾¡é–‹å§‹ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³2: ç‚¹æ»…ï¼‰ |
| `AUTO:3` | è‡ªå‹•åˆ¶å¾¡é–‹å§‹ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³3: è™¹è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ |
| `STOP` | è‡ªå‹•åˆ¶å¾¡åœæ­¢ |
| `CLEAR` | å…¨æ¶ˆç¯ |

### ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä»•æ§˜

#### LEDè¨­å®š
- **æ¥ç¶šãƒ”ãƒ³**: GPIO6
- **LEDæ•°**: 1å€‹ï¼ˆ`NUM_LEDS`ã§å¤‰æ›´å¯èƒ½ï¼‰
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«**: NeoPixel (WS2812Bäº’æ›)
- **é›»æº**: 5V (VBUS)

#### ãƒ‡ãƒã‚¤ã‚¹ID
- è¨­å®šå ´æ‰€: `pico/main.py`ã®`DEVICE_ID`å¤‰æ•°
- ç¯„å›²: 1-99
- ç”¨é€”: è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ä½¿ç”¨æ™‚ã®è­˜åˆ¥

### PWAï¼ˆProgressive Web Appï¼‰

#### ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
- ãƒ•ã‚¡ã‚¤ãƒ«: `app/manifest.json`
- ã‚¢ãƒ—ãƒªå: "Pico colorlight controller"
- ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼: `#f48fb1` (ãƒ”ãƒ³ã‚¯)

#### Service Worker
- ãƒ•ã‚¡ã‚¤ãƒ«: `app/service-worker.js`
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥: Cache First
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ

#### ã‚¢ã‚¤ã‚³ãƒ³
- SVG: `app/icons/icon.svg`
- PNG: 192x192, 512x512ã‚µã‚¤ã‚º

### éŸ³å£°è§£æï¼ˆéŸ³æ¥½é€£å‹•ãƒ¢ãƒ¼ãƒ‰ï¼‰

#### Web Audio API
- ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ: ãƒ‡ãƒã‚¤ã‚¹ä¾å­˜ï¼ˆé€šå¸¸44.1kHz/48kHzï¼‰
- FFTã‚µã‚¤ã‚º: 2048
- è§£æç¯„å›²: 20Hz - 20kHz

#### å‘¨æ³¢æ•°å¸¯åŸŸåˆ†é¡
- ä½éŸ³åŸŸ: 20-250Hz
- ä¸­éŸ³åŸŸ: 250-2000Hz
- é«˜éŸ³åŸŸ: 2000-20000Hz

#### éŸ³éšæ¤œå‡º
åŸºæº–å‘¨æ³¢æ•°ï¼ˆA4 = 440Hzï¼‰ã‚’åŸºæº–ã«Â±50centã®ç¯„å›²ã§æ¤œå‡º:
- C4 (261.63Hz)
- D4 (293.66Hz)
- E4 (329.63Hz)
- F4 (349.23Hz)
- G4 (392.00Hz)
- A4 (440.00Hz)
- B4 (493.88Hz)

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### æ¥ç¶šã§ããªã„å ´åˆ

**ç—‡çŠ¶**: ã€Œãƒ©ã‚¤ãƒˆã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ãƒ‡ãƒã‚¤ã‚¹ãŒè¡¨ç¤ºã•ã‚Œãªã„

**å¯¾å‡¦æ³•**:
- HTTPSã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆWeb Bluetooth APIã¯HTTPSå¿…é ˆï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ãŒWeb Bluetooth APIã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆChromeã€Edgeã€Operaæ¨å¥¨ï¼‰
- Pico WãŒèµ·å‹•ã—ã¦ãŠã‚Šã€é’è‰²ç‚¹æ»…ï¼ˆå¾…æ©ŸçŠ¶æ…‹ï¼‰ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- Bluetoothè¨­å®šã§ "Colorlight-X" ãƒ‡ãƒã‚¤ã‚¹ãŒæ¤œå‡ºå¯èƒ½ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®Bluetoothã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

### LEDãŒç‚¹ç¯ã—ãªã„å ´åˆ

**ç—‡çŠ¶**: æ¥ç¶šã¯æˆåŠŸã™ã‚‹ãŒLEDãŒç‚¹ç¯ã—ãªã„

**å¯¾å‡¦æ³•**:
- é…ç·šã‚’ç¢ºèªï¼ˆç‰¹ã«DIç·šãŒGPIO6ã«æ­£ã—ãæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ï¼‰
- é›»æºä¾›çµ¦ãŒååˆ†ã‹ç¢ºèªï¼ˆUSBé›»æºã®å®¹é‡ä¸è¶³ã®å¯èƒ½æ€§ï¼‰
- LEDãƒ†ãƒ¼ãƒ—ã®ä»•æ§˜ãŒNeoPixel (WS2812B) äº’æ›ã‹ç¢ºèª
- `pico/main.py`ã®`LED_PIN`ã¨`NUM_LEDS`ã®è¨­å®šã‚’ç¢ºèª
- Thonnyã®ã‚·ã‚§ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ã„ãªã„ã‹ç¢ºèª

### è‡ªå‹•åˆ¶å¾¡ãŒå‹•ä½œã—ãªã„å ´åˆ

**ç—‡çŠ¶**: è‡ªå‹•åˆ¶å¾¡ã‚’é–‹å§‹ã—ã¦ã‚‚è‰²ãŒå¤‰åŒ–ã—ãªã„

**å¯¾å‡¦æ³•**:
- Bluetoothæ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆæ¥ç¶šæ¸ˆã¿: Xå°ãŒ1ä»¥ä¸Šï¼‰
- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
- è‰²é¸æŠãƒ¢ãƒ¼ãƒ‰ã§æ‰‹å‹•åˆ¶å¾¡ã§ãã‚‹ã‹ç¢ºèªï¼ˆã§ããªã„å ´åˆã¯Bluetoothé€šä¿¡ã®å•é¡Œï¼‰
- Pico Wå´ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª

### éŸ³æ¥½é€£å‹•ãƒ¢ãƒ¼ãƒ‰ã§åå¿œã—ãªã„å ´åˆ

**ç—‡çŠ¶**: éŸ³æ¥½é€£å‹•ãƒ¢ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¦ã‚‚è‰²ãŒå¤‰åŒ–ã—ãªã„

**å¯¾å‡¦æ³•**:
- ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
- éŸ³é‡ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆå‹•ã„ã¦ã„ãªã„å ´åˆã¯ãƒã‚¤ã‚¯ã®å•é¡Œï¼‰
- æ„Ÿåº¦èª¿æ•´ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä¸Šã’ã¦ã¿ã‚‹
- éŸ³æ¥½ã®éŸ³é‡ã‚’ä¸Šã’ã¦ã¿ã‚‹
- åˆ¥ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ã‚’è©¦ã—ã¦ã¿ã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### è¤‡æ•°ãƒ‡ãƒã‚¤ã‚¹ã‚’æ¥ç¶šã§ããªã„å ´åˆ

**ç—‡çŠ¶**: 1å°ç›®ã¯æ¥ç¶šã§ãã‚‹ãŒã€2å°ç›®ä»¥é™ãŒæ¥ç¶šã§ããªã„

**å¯¾å‡¦æ³•**:
- å„Pico Wã®`DEVICE_ID`ãŒç•°ãªã‚‹å€¤ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®Bluetoothæ¥ç¶šæ•°åˆ¶é™ã‚’ç¢ºèªï¼ˆé€šå¸¸7å°ã¾ã§ï¼‰
- 1å°ãšã¤é †ç•ªã«æ¥ç¶šã—ã¦ã¿ã‚‹
- æ—¢ã«æ¥ç¶šæ¸ˆã¿ã®ãƒ‡ãƒã‚¤ã‚¹ã‚’èª¤ã£ã¦é¸æŠã—ã¦ã„ãªã„ã‹ç¢ºèª

### PWAãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„å ´åˆ

**ç—‡çŠ¶**: ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ãŒè¡¨ç¤ºã•ã‚Œãªã„

**å¯¾å‡¦æ³•**:
- HTTPSã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- `manifest.json`ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- Service WorkerãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼ˆé–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« > Application > Service Workersï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒªãƒ­ãƒ¼ãƒ‰

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒã‚°å ±å‘Šã‚„æ©Ÿèƒ½æ”¹å–„ã®ææ¡ˆã¯ Issue ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

## ğŸ”— å‚è€ƒè³‡æ–™

- [MicroPython Documentation](https://docs.micropython.org/)
- [Raspberry Pi Pico W Datasheet](https://datasheets.raspberrypi.com/picow/pico-w-datasheet.pdf)
- [NeoPixel (WS2812B) Datasheet](https://cdn-shop.adafruit.com/datasheets/WS2812B.pdf)
- [Web Bluetooth API - MDN](https://developer.mozilla.org/ja/docs/Web/API/Web_Bluetooth_API)
- [Web Audio API - MDN](https://developer.mozilla.org/ja/docs/Web/API/Web_Audio_API)

---

**æ³¨æ„**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯æ•™è‚²ãƒ»è¶£å‘³ç›®çš„ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯é›»æºãƒ»é…ç·šã®å®‰å…¨ã«ååˆ†æ³¨æ„ã—ã¦ãã ã•ã„ã€‚