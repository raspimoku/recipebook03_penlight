graph TB
    subgraph UserDevice["ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒã‚¤ã‚¹ (ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ / PC)"]
        subgraph Browser["ğŸŒ Web ãƒ–ãƒ©ã‚¦ã‚¶ (Chrome / Edge / Opera)"]
            subgraph PWA["PWA Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³"]
                HTML["index.html<br/>UI / ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼"]
                CSS["style.css<br/>ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°"]
                JS["script_multi.js<br/>ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯"]
                Manifest["manifest.json<br/>PWA ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ"]
                SW["service-worker.js<br/>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ (Cache First)"]
                WebBT["Web Bluetooth API<br/>BLE é€šä¿¡"]
                WebAudio["Web Audio API<br/>éŸ³å£°è§£æ (FFT 2048)"]
            end
        end
        Mic["ğŸ¤ ãƒã‚¤ã‚¯"]
    end

    subgraph Hosting["ğŸ“¡ ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°"]
        GHPages["GitHub Pages<br/>æœ¬ç•ªç’°å¢ƒ (HTTPS)"]
        DevServer["server.py<br/>HTTP é–‹ç™ºã‚µãƒ¼ãƒãƒ¼<br/>localhost:8000"]
    end

    subgraph PicoW["ğŸ”§ Raspberry Pi Pico W"]
        subgraph MicroPython["MicroPython v1.23.0+"]
            MainPy["main.py<br/>ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ "]
            BLEService["BLE ã‚µãƒ¼ãƒ“ã‚¹<br/>ã‚¢ãƒ‰ãƒã‚¿ã‚¤ã‚º & æ¥ç¶šç®¡ç†<br/>ãƒ‡ãƒã‚¤ã‚¹å: Colorlight-X<br/>è‰²ã€ã‚³ãƒãƒ³ãƒ‰åˆ¶å¾¡"]
            CmdHandler["ã‚³ãƒãƒ³ãƒ‰ãƒãƒ³ãƒ‰ãƒ©<br/>AUTO:1/2/3, STOP, CLEAR"]
            AutoCtrl["è‡ªå‹•åˆ¶å¾¡ã‚¨ãƒ³ã‚¸ãƒ³<br/>ãƒ‘ã‚¿ãƒ¼ãƒ³1: é †æ¬¡å¤‰åŒ–<br/>ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç‚¹æ»…<br/>ãƒ‘ã‚¿ãƒ¼ãƒ³3: è™¹è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³"]
            NeoPixelDrv["NeoPixel ãƒ‰ãƒ©ã‚¤ãƒ<br/>WS2812B åˆ¶å¾¡ (GPIO6)"]
        end
    end

    LED["ğŸ’¡ NeoPixel LED<br/>WS2812B äº’æ›<br/>ãƒ•ãƒ«ã‚«ãƒ©ãƒ¼ã‚·ãƒªã‚¢ãƒ«LED"]
    Power["ğŸ”‹ é›»æº<br/>USBãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªãƒ¼ (5V)<br/>ä¹¾é›»æ± "]

    JS --> WebBT
    JS --> WebAudio
    WebAudio --> Mic
    GHPages -->|HTTPS| Browser
    DevServer -.->|HTTP é–‹ç™ºç”¨| Browser

    WebBT <-->|"BLE<br/>RGB 3ãƒã‚¤ãƒˆ / UTF-8 ã‚³ãƒãƒ³ãƒ‰<br/>UUID: 12345678-...-9abc"| BLEService

    MainPy --> BLEService
    BLEService --> CmdHandler
    CmdHandler --> NeoPixelDrv
    CmdHandler --> AutoCtrl
    AutoCtrl --> NeoPixelDrv
    NeoPixelDrv -->|GPIO6| LED
    Power -->|USB| PicoW
